{# templates/produit/_liste.html.twig #}

<table class="table table-hover table-bordered align-middle">
  <thead class="table-dark">
    <tr>
      <th>ID</th>
      {# tri sur le nom    #}
      <th>
  {# on récupère tous les paramètres actuels (q, page, etc.) pour ne pas les perdre #}
  {% set params = app.request.query.all %}

  {# on inverse le tri si on reclique #}
 {% set nextSort = sort == 'name_asc' ? 'name_desc' : 'name_asc' %}

  {# on remet toujours page à 1 quand on change de tri #}
  {% set params = params|merge({'sort': nextSort, 'page': 1}) %}

  <a href="{{ path('app_produit_index', params) }}"
     class="text-decoration-none d-inline-flex align-items-center gap-1">
    Nom
    {# icône selon le tri actuel #}
    {% if sort == 'name_asc' %}
      ▲
    {% elseif sort == 'name_desc' %}
      ▼
    {% else %}
      ⇅
    {% endif %}
  </a>
</th>
      <th>Prix</th>
      <th>Référence</th>
      <th>Créé le</th>
      <th>Modifié le</th>
      <th>TVA</th>
      <th>Stock</th>
      <th>Stock min</th>
      <th>En commande</th>
      <th>État</th>
      <th>Réappro</th>
    </tr>
  </thead>
  <tbody>
    {% for produit in produits %}
      <tr class="row-click" data-href="{{ path('app_produit_show', {id: produit.id}) }}">
        <td>{{ produit.id }}</td>
        <td>{{ produit.nom }}</td>
        <td class="col-price text-end text-nowrap">{{ produit.prixUnitaire|number_format(2, ',', ' ') }} €</td>        
        <td class="col-price text-end text-nowrap">{{ produit.reference }}</td>
        <td>{{ produit.dateCreation ? produit.dateCreation|date('d/m/Y H:i') : '' }}</td>
        <td>{{ produit.dateModification ? produit.dateModification|date('d/m/Y H:i') : '' }}</td>
        <td class="col-price text-end text-nowrap">{{ produit.tva }} %</td>
        <td>{{ produit.quantiteStock }}</td>
        <td>{{ produit.stockMin }}</td>
        <td>{{ produit.enCommande }}</td>
        <td>
          {% if produit.etatStock == 'rupture' %}
            <span class="badge bg-danger">❌ Rupture</span>
          {% elseif produit.etatStock == 'sous_seuil' %}
            <span class="badge bg-warning text-dark">⚠️ Sous Seuil</span>
          {% else %}
            <span class="badge bg-success">✅ OK</span>
          {% endif %}
        </td>
  <td>
  {% if produit.etatStock in ['rupture', 'sous_seuil'] %}
    <a class="btn btn-sm btn-warning"
       href="{{ path('produit_reappro', {'id': produit.id}) }}">
       Réapprovisionner
    </a>
  {% else %}
    <span class="text-muted small">—</span>
  {% endif %}
</td>
      </tr>
    {% else %}
      <tr>
        <td colspan="13" class="text-center">⚠️ Aucun produit trouvé</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{# pagination #}
{% if pages > 1 %}
  <nav aria-label="Pagination produits" class="mt-3">
    <ul class="pagination">

      {# Précédent #}
      <li class="page-item {{ page == 1 ? 'disabled' : '' }}">
        <a class="page-link js-page"
           href="?page={{ page - 1 }}&q={{ q|default('') }}&sort={{ sort|default('recent') }}">
          Précédent
        </a>
      </li>

      {# pages #}
      {% for i in 1..pages %}
        <li class="page-item {{ i == page ? 'active' : '' }}">
          <a class="page-link js-page"
             href="?page={{ i }}&q={{ q|default('') }}&sort={{ sort|default('recent') }}">
            {{ i }}
          </a>
        </li>
      {% endfor %}

      {# Suivant #}
      <li class="page-item {{ page == pages ? 'disabled' : '' }}">
        <a class="page-link js-page"
           href="?page={{ page + 1 }}&q={{ q|default('') }}&sort={{ sort|default('recent') }}">
          Suivant
        </a>
      </li>

    </ul>
  </nav>
{% endif %}
