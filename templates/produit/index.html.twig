{% extends 'base.html.twig' %}

{% block titre %}Produits ‚Äî Logix G-Stock{% endblock %}

{% block contenu %}
<h1 class="mb-4">üì¶ Liste des produits</h1>

<table class="table table-hover table-bordered align-middle">
  <thead class="table-dark">
    <tr>
      <th>ID</th>
      <th>Nom</th>
      <th>Description</th>
      <th>Prix</th>
      <th>Stock</th>
      <th>R√©f√©rence</th>
      <th>Cr√©√© le</th>
      <th>Modifi√© le</th>
      <th>TVA</th>
      <th>Stock min</th>
      <th>En commande</th>
      <th>Stock projet√©</th>
      <th>√âtat</th>
      <th>R√©appro</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
  {% for produit in produits %}
    <tr>
      <td>{{ produit.id }}</td>
      <td>{{ produit.nom }}</td>
      <td>{{ produit.description }}</td>
      <td>{{ produit.prixUnitaire|number_format(2, ',', ' ') }} ‚Ç¨</td>
      <td>{{ produit.quantiteStock }}</td>
      <td>{{ produit.reference }}</td>
      <td>{{ produit.dateCreation ? produit.dateCreation|date('d/m/Y H:i') : '' }}</td>
      <td>{{ produit.dateModification ? produit.dateModification|date('d/m/Y H:i') : '' }}</td>
      <td>{{ produit.tva }} %</td>
      <td>{{ produit.stockMin }}</td>
      <td>{{ produit.enCommande }}</td>
      <td>{{ produit.quantiteStock + produit.enCommande }}</td>
      <td>
        {% if produit.etatStock == 'rupture' %}
          <span class="badge bg-danger">‚ùå Rupture</span>
        {% elseif produit.etatStock == 'sous_seuil' %}
          <span class="badge bg-warning text-dark">‚ö†Ô∏è Sous Seuil</span>
        {% else %}
          <span class="badge bg-success">‚úÖ OK</span>
        {% endif %}
      </td>

     {# --- R√©appro (bas√© sur le stock projet√© = stock + enCommande) --- #}
      <td>
        {% set stock_actuel = produit.quantiteStock %}
        {% set en_commande  = produit.enCommande %}
        {% set projete      = stock_actuel + en_commande %}
        {% set seuil        = produit.stockMin %}
        {% set rupture_phys = stock_actuel <= 0 %}
        {% set sous_seuil_projete = seuil is not null and projete < seuil %}

        {% if rupture_phys or sous_seuil_projete %}
          <a class="btn btn-sm btn-warning"
            href="{{ path('produit_reappro', {'id': produit.id}) }}">
            R√©approvisionner
          </a>
        {% else %}
          <span class="text-muted" title="Stock projet√© {{ projete }} ‚â• seuil {{ seuil ?? '-' }}">‚Äî</span>
        {% endif %}
      </td>

      <td>
        <a class="btn btn-sm btn-outline-primary" href="{{ path('app_produit_show', {'id': produit.id}) }}">Afficher</a>
        <a class="btn btn-sm btn-outline-warning" href="{{ path('app_produit_edit', {'id': produit.id}) }}">Modifier</a>
      </td>
    </tr>
  {% else %}
    <tr>
      <td colspan="15" class="text-center">‚ö†Ô∏è Aucun produit trouv√©</td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<a class="btn btn-success" href="{{ path('app_produit_new') }}">‚ûï Ajouter un produit</a>
<a class="btn btn-outiline-secondary ms-2" href="{{path('app_accueil')}}">üè†Retour √† l'accueil</a>
{% endblock %}
