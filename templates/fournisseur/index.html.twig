{% extends 'base.html.twig' %}

{% block titre %}Liste des fournisseurs â€” Logix G-Stock{% endblock %}



{% block contenu %}
<h1 class="mb-4">ğŸ­ Fournisseurs</h1>

{# barre de recherche #}
<form id="fournisseur-search-form"
      method="get"
      action="{{ path('app_fournisseur_index') }}"
      class="search-pill mb-3">

  <input
    type="text"
    name="q"
    value="{{ q ?? '' }}"
    class="search-pill-input"
    placeholder="Rechercher par nom ou rÃ©fÃ©rence..."
  >

  <button class="search-pill-btn" type="submit" aria-label="Rechercher">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
</form>

 <a class="btn btn-success btn-sm fournisseur-add-btn"
     href="{{ path('app_fournisseur_new') }}">
    â• Ajouter un fournisseur
  </a>

<div id="fournisseur-table-wrapper">
  {% include 'fournisseur/_liste.html.twig' %}
</div>
{% endblock %}



{% block javascripts %}
  {{ parent() }}
  <script>
    const form = document.getElementById('fournisseur-search-form');
    const input = form.querySelector('input[name="q"]');
    const wrapper = document.getElementById('fournisseur-table-wrapper');

    function loadFournisseurs(queryString) {
      fetch('{{ path('app_fournisseur_index') }}' + queryString, {
        headers: {'X-Requested-With': 'XMLHttpRequest'}
      })
      .then(r => r.text())
      .then(html => {
        wrapper.innerHTML = html;
        bindFournisseurPagination();
      });
    }

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const q = input.value;
      loadFournisseurs('?q=' + encodeURIComponent(q) + '&page=1');
    });

    function bindFournisseurPagination() {
      wrapper.querySelectorAll('.js-page').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          loadFournisseurs(this.getAttribute('href'));
        });
      });
    }

    bindFournisseurPagination();
  </script>
{% endblock %}