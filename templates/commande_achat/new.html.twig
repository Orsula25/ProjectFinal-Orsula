{% extends 'base.html.twig' %}

{% block titre %}Nouvelle commande d'achat{% endblock %}

{% block contenu %}
<h1>Nouvelle commande d'achat</h1>

{{ form_start(form) }}
    {{ form_row(form.reference) }}
    {{ form_row(form.fournisseur) }}

    <h3>Produits</h3>

    <div id="lignes-commande"
         data-prototype="{{ form_widget(form.lignesCommande.vars.prototype)|e('html_attr') }}">
        {% for ligneForm in form.lignesCommande %}
            <div class="ligne-item mb-2">
                {{ form_row(ligneForm) }}
            </div>
        {% endfor %}
    </div>

    <button type="button" class="btn btn-sm btn-outline-secondary mt-2" id="add-ligne">
        + Ajouter un produit
    </button>

    <button class="btn btn-primary mt-4">Enregistrer le brouillon</button>
{{ form_end(form) }}

<a class="btn btn-link mt-3" href="{{ path('app_commande_achat_index') }}">⬅ Retour à la liste</a>

{# petit JS pour dupliquer une ligne #}
<script>
    const container = document.getElementById('lignes-commande');
    const addBtn = document.getElementById('add-ligne');

    if (addBtn) {
        let index = {{ form.lignesCommande|length }};

        addBtn.addEventListener('click', function () {
            const prototype = container.dataset.prototype;
            const newForm = prototype.replace(/__name__/g, index);
            index++;

            const div = document.createElement('div');
            div.classList.add('ligne-item', 'mb-2');
            div.innerHTML = newForm;

            container.appendChild(div);
        });
    }
</script>
{% endblock %}
