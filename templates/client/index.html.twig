{% extends 'base.html.twig' %}

{% block titre %}Clients — Logix G-Stock{% endblock %}

{% block contenu %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

{# barre de recherche #}
<form id="client-search-form"
      method="get"
      action="{{ path('app_client_index') }}"
      class="search-pill mb-3">

  <input
    type="text"
    name="q"
    value="{{ q ?? '' }}"
    class="search-pill-input"
    placeholder="Rechercher par nom ou référence..."
  >

  <button class="search-pill-btn" type="submit" aria-label="Rechercher">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
</form>

 <a class="btn btn-success btn-sm client-add-btn"
     href="{{ path('app_client_new') }}">
    ➕ Ajouter un client
  </a>

<div id="client-table-wrapper">
  {% include 'client/_liste.html.twig' %}
</div>


{% endblock contenu %}

{% block javascripts %}
  {{ parent() }}
  <script>
    const form = document.getElementById('client-search-form');
    const input = form.querySelector('input[name="q"]');
    const wrapper = document.getElementById('client-table-wrapper');

    function loadClients(queryString) {
      fetch('{{ path('app_client_index') }}' + queryString, {
        headers: {'X-Requested-With': 'XMLHttpRequest'}
      })
      .then(r => r.text())
      .then(html => {
        wrapper.innerHTML = html;
        bindClientPagination();
      });
    }

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const q = input.value;
      loadClients('?q=' + encodeURIComponent(q) + '&page=1');
    });

    function bindClientPagination() {
      wrapper.querySelectorAll('.js-page').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          loadClients(this.getAttribute('href'));
        });
      });
    }

    bindClientPagination();
  </script>
{% endblock %}